
#include "alignment_parameters.h"

int set_subm_gaps(struct parameters* param, struct aln_param* ap);

int set_param_number(struct aln_param* ap,int L, int sel);
struct aln_param* init_ap(struct parameters* param,int numseq,int L)
{
        struct aln_param* ap = NULL;
        int i,j;


        MMALLOC(ap, sizeof(struct aln_param));

        ap->tree = NULL;
        MMALLOC(ap->tree, sizeof(int) * (numseq*3+1));

        for(i = 0;i < (numseq*3+1);i++){
                ap->tree[i] = 0;
        }
        ap->subm = NULL;

        srand48_r(time(NULL), &ap->randBuffer);
        MMALLOC(ap->subm,sizeof (float*) * 32);
        for (i = 32;i--;){
                ap->subm[i] = NULL;
                MMALLOC(ap->subm[i],sizeof(float) * 32);
                for (j = 32;j--;){
                        ap->subm[i][j] = 0.0f;
                }
        }
        if(param->param_set == -1){
                RUN(set_subm_gaps(param, ap));
        }else{
                set_param_number(ap, L, param->param_set);
        }


        return ap;
ERROR:
        free_ap(ap);
        return NULL;
}

int set_param_number(struct aln_param* ap,int L, int sel)
{
        int i,j,m_pos;
        double* ptr = NULL;


        double defprot_set10[5][234] = {{ 2.092803 ,0.876965,4.571803,0.029453,-0.649496,2.913864,0.342510,-0.573038,1.086124,2.429128,-0.114084,0.274722,-0.617559,-0.448661,3.036445,0.371849,-0.209683,0.035156,-0.164882,-0.470811,2.959292,-0.133703,-0.168992,0.252991,0.399551,0.282545,-0.124909,3.881692,0.237057,0.577413,-0.979859,-0.664751,0.810565,-1.003541,-0.426116,2.551111,0.442925,-0.493743,0.428430,0.896915,-0.612086,-0.117025,0.281382,-0.470091,2.439196,0.208292,0.377705,-0.817856,-0.462710,1.134827,-0.823758,-0.113911,1.395335,-0.262955,2.285028,0.381774,0.710151,-0.448320,-0.150716,0.993478,-0.512999,0.061324,1.057757,0.048727,1.402686,3.204686,0.018105,0.232110,0.972393,0.473589,-0.302467,0.373754,0.901659,-0.616034,0.398831,-0.344832,-0.079160,2.816327,0.101832,0.123655,0.136063,0.306000,0.056169,-0.055560,-0.190787,-0.343589,0.194647,-0.293358,-0.291342,0.226807,3.241786,0.315515,-0.226680,0.659947,1.112614,-0.187495,-0.116407,0.706864,-0.379995,1.014410,-0.045137,0.369483,0.676162,0.137577,2.461226,0.203748,-0.140300,0.194944,0.623172,-0.560329,-0.352923,0.534181,-0.451711,1.325280,-0.151752,0.054566,0.547263,0.149346,1.006315,2.805705,0.802136,0.369735,0.464981,0.418066,-0.132553,0.500389,0.110945,-0.354642,0.379981,-0.309928,0.092517,0.717817,0.322409,0.506098,0.294684,2.098666,0.543766,0.813273,0.202961,0.267570,0.035997,0.028511,0.192955,0.157178,0.322749,0.030700,0.413262,0.491547,0.126530,0.398522,0.402365,1.087376,2.344817,0.519507,0.838918,-0.792819,-0.433940,0.593311,-0.831040,-0.357581,1.798147,-0.223060,0.994449,0.824421,-0.530279,-0.062604,-0.142594,-0.299912,-0.119652,0.490269,2.377342,-0.285041,-0.625793,0.085971,-0.234970,1.467414,-0.601082,0.583116,0.027401,-0.524095,0.449515,0.368021,-0.150937,-0.505888,0.173715,-0.147007,0.151227,-0.101014,-0.154819,4.904864,-0.044859,-0.116544,-0.235054,-0.198166,1.721744,-0.376155,0.895017,0.227916,-0.197310,0.451543,0.575609,-0.204660,-0.199602,0.310563,0.129223,0.037097,0.129061,0.162576,1.731968,3.301875,0.756540,0.786792,-0.164020,0.118212,1.112375,-0.390654,-0.420575,1.102103,0.667336,1.344548,1.991768,0.422977,-1.102280,0.629436,0.172021,0.641524,0.614204,0.652609,0.245524,0.225009,0.402155,3.456315,0.323870,0.001273},
{ 2.024289 ,0.910961,3.926125,0.122858,-0.337140,2.555881,0.416546,-0.333275,1.312831,2.160436,-0.089935,0.484867,-0.433985,-0.576270,2.959256,0.489609,0.179635,0.012470,-0.369560,-0.684563,3.036670,0.369505,0.314080,0.512119,0.409331,0.819808,-0.250041,3.140880,0.162207,0.573931,-0.737588,-0.401719,1.032865,-0.930796,0.078376,2.430584,0.426997,0.080077,0.542841,0.910736,-0.502007,-0.147459,0.586782,-0.345332,2.321469,0.102437,0.792834,-0.495071,-0.159921,1.198537,-0.808802,0.340495,1.396814,0.009220,2.107959,0.430051,0.638934,-0.374168,-0.053860,1.013009,-0.428084,0.579643,1.134343,0.307545,1.364992,2.912509,0.204661,0.416485,1.139028,0.542106,-0.172923,0.400799,0.955519,-0.504287,0.689172,-0.144909,0.039535,2.678642,0.192959,0.521559,0.447925,0.369318,-0.124782,0.091376,0.507267,-0.111764,0.207420,-0.071194,0.334076,0.302676,3.169850,0.479068,-0.014765,0.677875,1.107669,-0.242262,-0.059310,0.826982,-0.260232,1.146111,0.134429,0.293111,0.653556,0.362501,2.235567,0.101409,0.269632,0.188609,0.470821,-0.339696,-0.409787,0.480832,-0.077471,1.112731,0.029197,0.272555,0.466276,0.033178,0.681322,2.875586,0.792276,0.841622,0.481032,0.543713,-0.265285,0.393954,0.374700,-0.482916,0.321342,-0.235156,-0.024609,0.693193,0.588081,0.507613,0.075814,2.198521,0.445931,0.534315,0.202641,0.071911,0.129038,0.143718,0.302201,0.216271,0.323747,0.040415,0.319677,0.485346,0.094364,0.342381,0.168291,1.266051,2.498567,0.582317,0.977097,-0.656514,-0.289674,0.818394,-0.824436,0.074005,1.713775,-0.118736,1.057853,0.820388,-0.210057,-0.093751,-0.069148,0.027458,-0.116167,0.578367,2.237374,0.123345,0.483565,-0.383506,-0.248583,1.318140,-0.163364,0.813280,0.390749,-0.049556,0.778977,1.193094,-0.096181,0.018089,0.112239,-0.147875,-0.248879,-0.191814,0.583448,5.036510,0.174209,0.390649,-0.183974,-0.409017,1.948500,-0.545479,1.124000,0.247317,-0.180481,0.437337,0.593932,-0.151486,0.114891,-0.098072,-0.285285,-0.028914,0.001452,0.090822,1.579353,3.355405,1.456621,4.596877,2.029366,1.688396,2.714965,1.623532,3.516647,3.492867,2.024951,1.375723,3.527460,2.594354,2.471706,2.644875,2.038987,3.558288,2.189463,3.283195,4.715268,2.875254,19.225184,3.527833,0.294760,0.001125},
{ 3.141965 ,-1.759947,5.431378,-0.989373,-5.373292,3.944080,-0.923941,-1.724557,2.082087,3.221350,-3.120533,-6.107561,-7.055805,-3.866502,3.745687,-0.139578,-5.834425,-2.197707,-5.008404,-7.516939,4.151195,0.385335,-2.864728,-1.491044,0.420725,2.452758,-4.274106,1.017519,-2.271018,-0.749705,-3.572418,-3.267638,-2.368088,-1.664318,-1.648817,4.349960,0.077441,-2.017647,-1.573574,-0.799308,-4.825692,-2.457399,-1.042290,-1.046849,3.089036,-5.209754,-7.196783,-3.897099,-2.765899,-0.231838,-3.699270,-0.592069,0.619041,-3.789382,2.690809,0.173571,0.143473,-0.219808,-2.074899,-3.676544,-0.917981,-1.170676,-0.012585,-0.908558,0.102131,4.935238,-0.859257,-5.365660,-0.532544,0.276279,-3.726245,-1.489635,0.718222,-1.757431,0.164137,-2.851993,-0.864253,3.672439,-0.372142,0.174262,-1.063489,-2.236755,-0.475830,-2.887193,-0.402922,-4.069259,-2.655377,-4.734977,-2.591118,1.488464,5.223215,-0.972136,-0.795934,0.096344,0.035669,-4.204273,-3.172145,1.292317,-0.897764,-2.114359,-1.075071,-0.206219,0.618549,-0.224340,3.425147,-1.487223,-5.675886,-1.536667,-0.679939,-2.603512,-2.561702,-2.530604,-2.759535,0.701141,-0.679437,-2.396872,-1.001788,-3.536008,-1.590394,4.009178,-0.328093,1.048870,-3.172392,-1.076198,-5.906662,-1.174094,0.506096,-1.423275,-0.502857,-2.258918,-0.655627,0.742131,-0.276915,-3.905822,-1.930666,3.537297,0.538670,-6.084500,-2.862819,-0.889245,-3.066574,-1.208476,0.283174,-1.698664,-0.985938,-2.101348,-1.168056,-0.118222,-0.696695,-1.011287,-2.691482,1.332337,3.378228,-0.140707,-0.692150,0.470030,-0.570673,-0.441778,-5.560960,-0.591262,0.603488,-3.241681,0.310303,-0.235138,-2.770266,-2.689776,-1.994537,-1.080492,-0.981056,-1.256446,4.071710,0.050046,1.418893,-3.955616,-1.065873,-5.689885,-4.416749,-1.447052,-2.469533,-4.599971,-1.921126,-1.898282,-2.140629,-1.867494,-1.219560,-3.673247,-0.221510,-2.207393,-2.733906,5.871784,-5.791239,-3.871377,-4.819620,0.276573,2.376847,-4.280754,2.010871,-1.485541,-0.763536,-1.088523,-2.762287,-2.490060,-3.731499,-5.668528,-5.122215,-2.255439,-2.360904,-0.790556,-3.453701,5.271009,3.973633,5.893495,4.945251,4.134554,4.210982,4.484117,7.453815,5.109406,3.715933,3.121760,6.002584,4.952883,6.033373,4.096344,4.642657,4.509432,4.234042,5.166961,6.311171,6.447166,16.212038,4.459312,0.473849,0.636328},
{ 2.535283 ,0.803586,5.270853,-0.335596,-0.992409,3.148424,0.066078,-1.189226,1.176542,2.745708,-0.549196,-0.002506,-1.370228,-1.219628,3.596400,0.211147,-0.728277,-0.159762,-0.521340,-1.535420,3.323427,-0.372747,-0.377784,0.153398,0.122402,0.133972,-0.757007,4.132194,-0.157646,0.158620,-1.546672,-1.111853,0.488059,-1.719678,-0.960258,2.804650,0.105356,-0.997768,0.286611,0.850237,-1.103307,-0.348310,0.244862,-0.839501,2.673257,-0.218295,0.067944,-1.294290,-0.972210,0.965794,-1.619415,-0.467049,1.341300,-0.628415,2.574399,0.044195,0.412861,-1.107507,-0.516792,0.822926,-1.148104,-0.306253,0.936649,-0.309720,1.540613,3.695369,-0.124767,-0.410624,1.104651,0.339059,-0.834127,0.383621,0.773497,-1.122342,0.530102,-0.782924,-0.350411,3.155342,0.063794,-0.902983,-0.176210,-0.076224,-0.895027,-0.606994,-0.428294,-0.845480,-0.091347,-0.838965,-0.854961,-0.302022,3.850491,0.148246,-0.594084,0.432221,1.072704,-0.714781,-0.481651,0.701083,-0.667920,1.061666,-0.279045,0.274842,0.545740,-0.234855,3.115341,-0.269580,-0.644461,-0.370926,0.105923,-1.018889,-0.814890,0.539938,-0.903396,1.376965,-0.668018,-0.405774,0.102307,-0.626667,0.778499,3.369600,0.867913,0.369568,0.341881,0.146510,-0.787175,0.183992,0.038902,-0.860263,0.198569,-0.823259,-0.198234,0.778029,0.136493,0.291970,-0.079568,2.718471,0.319360,0.397764,-0.078494,0.020136,-0.643117,-0.641482,-0.131564,-0.038863,0.152174,-0.293787,0.168638,0.355521,-0.251513,0.148560,-0.196191,1.157181,2.993682,0.384210,0.739860,-1.391206,-0.931298,0.175818,-1.562637,-0.657946,1.833205,-0.621807,0.799532,0.555566,-0.898295,-0.617643,-0.536936,-0.795672,-0.519307,0.492824,2.689526,-0.663056,-0.486296,-1.378561,-1.061219,1.404597,-1.476427,0.477810,-0.317885,-0.933129,-0.046635,0.193701,-0.826859,-1.046863,-0.619596,-0.728424,-0.714304,-0.713919,-0.418850,5.513766,-0.480183,-0.275939,-1.080155,-0.956641,1.957691,-1.325826,1.082312,-0.168909,-0.649880,0.211197,0.247250,-0.454416,-1.079885,-0.358212,-0.333924,-0.609853,-0.531853,-0.194583,1.546243,3.921572,1.221272,3.852462,2.665813,2.375326,2.135007,1.258541,2.867118,1.600075,1.671305,1.013128,3.060819,2.208209,2.013740,3.448869,2.789762,2.748962,2.816016,1.414694,3.781514,3.407426,20.980390,3.619596,0.414358,0.007460},
{ 2.596904 ,0.379875,5.513381,-0.589793,-1.837928,3.381012,0.017609,-1.997965,1.094249,2.965538,-0.838813,-0.836638,-1.933820,-1.777258,3.961151,-0.115660,-1.476226,-0.656250,-0.930612,-1.506225,3.282538,-0.619041,-1.413581,-0.082176,-0.394066,-0.080285,-1.051156,4.742401,-0.724280,-0.881025,-2.182675,-1.682128,0.283652,-2.454819,-1.285925,3.079048,-0.096374,-2.381995,0.077395,0.771195,-1.293108,-0.613156,0.270315,-1.408639,2.849550,-0.748045,-1.010212,-2.014758,-1.505438,0.893900,-2.109058,-0.881895,1.296269,-1.068774,2.822385,-0.341463,-0.264882,-1.525623,-1.160541,1.028796,-1.814395,-0.836400,0.903894,-0.613719,1.504307,4.223625,-0.347638,-1.355799,0.933479,0.105830,-1.306144,-0.100624,0.613567,-1.872510,0.248845,-1.355694,-1.250272,3.631539,-0.433555,-1.139808,-0.652271,-0.267771,-1.328781,-0.679040,-0.915491,-1.726307,-0.436063,-1.120769,-1.299615,-0.616008,4.153710,-0.147319,-1.389118,0.105080,0.983097,-0.849994,-1.123625,0.524964,-1.122955,0.878571,-0.619692,0.044198,0.058612,-0.501251,3.641264,-0.519732,-1.778767,-0.599238,0.228763,-0.876264,-1.176857,0.363233,-1.070242,1.307803,-0.840263,-0.538406,-0.090498,-0.624707,0.821984,3.709488,0.699625,-0.202568,0.138961,0.060805,-1.053606,-0.296047,-0.227104,-1.411535,0.034375,-1.267697,-0.889152,0.311640,-0.099197,-0.059821,-0.172784,2.950136,0.010243,-0.054160,-0.474583,-0.131756,-0.493384,-1.087700,-0.300636,-0.453587,0.004365,-0.570442,-0.456578,-0.122948,-0.466890,0.084343,-0.175521,1.136795,3.158569,0.046199,0.335119,-1.763603,-1.131587,-0.097509,-1.983847,-0.843890,1.714373,-0.916072,0.740684,0.484828,-1.399261,-0.917157,-0.800574,-0.958743,-0.935295,0.232419,2.822177,-1.584090,-1.046146,-1.869752,-1.917785,1.573073,-1.202712,0.049350,-0.780405,-1.277158,-0.613534,0.045888,-0.989511,-1.757609,-1.328096,-0.513906,-0.942313,-0.711578,-1.110903,5.990275,-1.112394,-0.768445,-1.230768,-1.162335,2.137181,-1.773792,0.905012,-0.997172,-0.841912,-0.173615,-0.219781,-0.864040,-1.248359,-0.713409,-0.286828,-0.824450,-0.884864,-0.913136,1.990800,4.338803,-0.061431,-0.440747,1.423161,1.440528,-0.128697,-0.774012,-0.680230,0.243142,0.500835,-0.260814,0.501540,0.788839,-1.035544,2.216375,-0.985344,0.617485,0.114635,0.032835,-2.464350,-0.738931,5.496464,3.723645,0.430571,0.020240}
};
        ptr = defprot_set10[sel];
        m_pos = 0;
        for (i = 0;i < L;i++){
                for (j = 0;j <= i;j++){

                        ap->subm[i][j] = ptr[m_pos];
                        ap->subm[j][i] = ap->subm[i][j];
                        m_pos++;
                }
        }

        ap->gpo = ptr[m_pos];
        m_pos++;
        ap->gpe = ptr[m_pos];
        m_pos++;

        ap->tgpe = ptr[m_pos];

        return OK;
}


void free_ap(struct aln_param* ap)
{
        int i;
        if(ap){
                if(ap->subm){
                        for (i = 32;i--;){
                                MFREE(ap->subm[i]);
                        }
                        MFREE(ap->subm);
                }
                if(ap->tree){
                        MFREE(ap->tree);
                }
                MFREE(ap);
        }
}


int set_subm_gaps(struct parameters* param, struct aln_param* ap)
{
        int i,j;
        int m_pos = 0;
        short *matrix_pointer = 0;
        short blosum50mt[]={
                5,
                -2,  5,
                -1, -3, 13,
                -2,  5, -4,  8,
                -1,  1, -3,  2,  6,
                -3, -4, -2, -5, -3,  8,
                0, -1, -3, -1, -3, -4,  8,
                -2,  0, -3, -1,  0, -1, -2, 10,
                -1, -4, -2, -4, -4,  0, -4, -4,  5,
                -1,  0, -3, -1,  1, -4, -2,  0, -3,  6,
                -2, -4, -2, -4, -3,  1, -4, -3,  2, -3,  5,
                -1, -3, -2, -4, -2,  0, -3, -1,  2, -2,  3,  7,
                -1,  4, -2,  2,  0, -4,  0,  1, -3,  0, -4, -2,  7,
                -1, -2, -4, -1, -1, -4, -2, -2, -3, -1, -4, -3, -2, 10,
                -1,  0, -3,  0,  2, -4, -2,  1, -3,  2, -2,  0,  0, -1,  7,
                -2, -1, -4, -2,  0, -3, -3,  0, -4,  3, -3, -2, -1, -3,  1,  7,
                1,  0, -1,  0, -1, -3,  0, -1, -3,  0, -3, -2,  1, -1,  0, -1,  5,
                0,  0, -1, -1, -1, -2, -2, -2, -1, -1, -1, -1,  0, -1, -1, -1,  2,  5,
                0, -4, -1, -4, -3, -1, -4, -4,  4, -3,  1,  1, -3, -3, -3, -3, -2,  0,  5,
                -3, -5, -5, -5, -3,  1, -3, -3, -3, -3, -2, -1, -4, -4, -1, -3, -4, -3, -3, 15,
                -1, -1, -2, -1, -1, -2, -2, -1, -1, -1, -1, -1, -1, -2, -1, -1, -1,  0, -1, -3, -1,
                -2, -3, -3, -3, -2,  4, -3,  2, -1, -2, -1,  0, -2, -3, -1, -1, -2, -2, -1,  2, -1,  8,
                -1,  2, -3,  1,  5, -4, -2,  0, -3,  1, -3, -1,  0, -1,  4,  0,  0, -1, -3, -2, -1, -2,  5};

        short blosum62mt[]={
                40,
                -20,  40,
                0, -30,  90,
                -20,  40, -30,  60,
                -10,  10, -40,  20,  50,
                -20, -30, -20, -30, -30,  60,
                0, -10, -30, -10, -20, -30,  60,
                -20,  0, -30, -10,  0, -10, -20,  80,
                -10, -30, -10, -30, -30,  0, -40, -30,  40,
                -10,  0, -30, -10,  10, -30, -20, -10, -30,  50,
                -10, -40, -10, -40, -30,  0, -40, -30,  20, -20,  40,
                -10, -30, -10, -30, -20,  0, -30, -20,  10, -10,  20,  50,
                -20,  30, -30,  10,  0, -30,  0,  10, -30,  0, -30, -20,  60,
                -10, -20, -30, -10, -10, -40, -20, -20, -30, -10, -30, -20, -20,  70,
                -10,  0, -30,  0,  20, -30, -20,  0, -30,  10, -20,  0,  0, -10,  50,
                -10, -10, -30, -20,  0, -30, -20,  0, -30,  20, -20, -10,  0, -20,  10,  50,
                10,  0, -10,  0,  0, -20,  0, -10, -20,  0, -20, -10,  10, -10,  0, -10,  40,
                0, -10, -10, -10, -10, -20, -20, -20, -10, -10, -10, -10,  0, -10, -10, -10,  10,  50,
                0, -30, -10, -30, -20, -10, -30, -30,  30, -20,  10,  10, -30, -20, -20, -30, -20,  0,  40,
                -30, -40, -20, -40, -30,  10, -20, -20, -30, -30, -20, -10, -40, -40, -20, -30, -30, -20, -30, 110,
                0, -10, -20, -10, -10, -10, -10, -10, -10, -10, -10, -10, -10, -20, -10, -10,  0,  0, -10, -20, -10,
                -20, -30, -20, -30, -20,  30, -30,  20, -10, -20, -10, -10, -20, -30, -10, -20, -20, -20, -10,  20, -10,  70,
                -10,  10, -30,  10,  40, -30, -20,  0, -30,  10, -30, -10,  0, -10,  30,  0,  0, -10, -20, -30, -10, -20,  40};

        short gon250mt[]={
                24,
                0,   0,
                5,   0, 115,
                -3,   0, -32,  47,
                0,   0, -30,  27,  36,
                -23,   0,  -8, -45, -39,  70,
                5,   0, -20,   1,  -8, -52,  66,
                -8,   0, -13,   4,   4,  -1, -14,  60,
                -8,   0, -11, -38, -27,  10, -45, -22,  40,
                -4,   0, -28,   5,  12, -33, -11,   6, -21,  32,
                -12,   0, -15, -40, -28,  20, -44, -19,  28, -21,  40,
                -7,   0,  -9, -30, -20,  16, -35, -13,  25, -14,  28,  43,
                -3,   0, -18,  22,   9, -31,   4,  12, -28,   8, -30, -22,  38,
                3,   0, -31,  -7,  -5, -38, -16, -11, -26,  -6, -23, -24,  -9,  76,
                -2,   0, -24,   9,  17, -26, -10,  12, -19,  15, -16, -10,   7,  -2,  27,
                -6,   0, -22,  -3,   4, -32, -10,   6, -24,  27, -22, -17,   3,  -9,  15,  47,
                11,   0,   1,   5,   2, -28,   4,  -2, -18,   1, -21, -14,   9,   4,   2,  -2,  22,
                6,   0,  -5,   0,  -1, -22, -11,  -3,  -6,   1, -13,  -6,   5,   1,   0,  -2,  15,  25,
                1,   0,   0, -29, -19,   1, -33, -20,  31, -17,  18,  16, -22, -18, -15, -20, -10,   0,  34,
                -36,   0, -10, -52, -43,  36, -40,  -8, -18, -35,  -7, -10, -36, -50, -27, -16, -33, -35, -26, 142,
                0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,
                -22,   0,  -5, -28, -27,  51, -40,  22,  -7, -21,   0,  -2, -14, -31, -17, -18, -19, -19, -11,  41,   0,  78,
                0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0};


        if(param->sub_matrix){
                if(byg_start(param->sub_matrix,"blosum62BLOSUM62") != -1){
                        matrix_pointer = blosum62mt;
                        //m_pos = 0;
                        //for (i = 0;i < 23;i++){
                        //	for (j = 0;j <= i;j++){
                        //		matrix_pointer[m_pos] = matrix_pointer[m_pos] * 10;
                        //		m_pos++;
                        //	}
                        //}
                        ap->gpo = 55;
                        ap->gpe = 8;
                        ap->tgpe = 1;
                }
                if(byg_start(param->sub_matrix,"blosum50BLOSUM50") != -1){
                        matrix_pointer = blosum50mt;
                        m_pos = 0;
                        for (i = 0;i < 23;i++){
                                for (j = 0;j <= i;j++){
                                        matrix_pointer[m_pos] = matrix_pointer[m_pos] * 10;
                                        m_pos++;
                                }
                        }
                        ap->gpo = 55;
                        ap->gpe = 8;
                        ap->tgpe = 1;
                }
                //vogt....

        }else{
                //LOG_MSG("DNA>>>>> %d", param->dna);
                if(!param->dna){
                        // gpo:5.494941        gpe:0.852492        tgpe:0.442410       bonus: 3.408872     z-cutoff: 58.823309 -> 0.829257 accuracy on bb3
                        ap->gpo = 54.94941;
                        ap->gpe = 8.52492;
                        ap->tgpe = 4.42410;

                        //gpo = 54;
                        //gpe = 8;
                        //tgpe = 4;
                        //-gpo 10.9898        -gpe 0.852492      -tgpe  0.442410    -bonus    0.2   -zcutoff     58.823309
                        //	param->secret = 0.2;
                        matrix_pointer = gon250mt;
                }else{
                        //gpo = 400;
                        //	gpe =  30;
                        //tgpe = 30;

                        //param->gpo = 43.4;
                        //param->gpe = 3.94;
                        //param->tgpe = 29.26;

                        //gpo = 43.4 *5;
                        ap->gpo = 217;
                        ap->gpe = 39.4;
                        ap->tgpe =  292.6;
                        //param->secret = 28.3;
                        param->zlevel = 61.08;
                        param->internal_gap_weight = 49.14;

                }
        }
        if(param->gpo!= -1){
                //param->gpo *= 5;
                ap->gpo = param->gpo;
        }
        if(param->gpe != -1){
                //param->gpe *= 10;
                ap->gpe = param->gpe;
        }
        if(param->tgpe != -1){
                //param->tgpe *= 10;
                ap->tgpe = param->tgpe;
        }

//	if(param->secret != -1){
//		//param->secret *= 10;
//	}else{
        if(param->secret == -1){
                if(!param->dna){
                        param->secret = 0.2;
                }else{
                        param->secret = 283.0;
                }
        }


        //fprintf(stderr,"%d	%d	%d	%d\n",gpo,gpe,tgpe,	 (int)param->secret);

        for (i = 32;i--;){

                for (j = 32;j--;){
                        ap->subm[i][j] = param->secret;//0;//gpe << 1;//-5;// better on Balibase
                }
        }
        if(param->dna){
                /*subm[0][0] += 10;
                  subm[0][1] += 6;
                  subm[1][0] += 6;
                  subm[1][1] += 10;
                  subm[2][2] += 10;
                  subm[2][3] += 6;
                  subm[3][2] += 6;
                  subm[3][3] += 10;*/
//		     A    C    G    T    .    N
//	A   91 -114  -31 -123    0  -43
                ap->subm[0][0] += 91;
                ap->subm[0][1] += -114;
                ap->subm[0][2] += -31;
                ap->subm[0][3] += -123;

//	C -114  100 -125  -31    0  -43
                ap->subm[1][0] += -114;
                ap->subm[1][1] += 100;
                ap->subm[1][2] += -125;
                ap->subm[1][3] += -31;

//	G  -31 -125  100 -114    0  -43
                ap->subm[2][0] += -31;
                ap->subm[2][1] += -125;
                ap->subm[2][2] += 100;
                ap->subm[2][3] += -114;

//	T -123  -31 -114   91    0  -43
                ap->subm[3][0] += -123;
                ap->subm[3][1] += -31;
                ap->subm[3][2] += -114;
                ap->subm[3][3] += 91;

//	.    0    0    0    0    0    0
//	N  -43  -43  -43  -43    0  -43


                /*for (i = 0; i < 4;i++){
                  for (j = 0;j < 4;j++){
                  if(i == j){
                  subm[i][j] += 1;
                  }else{
                  subm[i][j] -= 3;
                  }
                  }
                  }*/

        }else{

                m_pos = 0;
                for (i = 0;i < 23;i++){
                        for (j = 0;j <= i;j++){
                                if (i == j){
                                        //	subm[i][j] += blosum62mt[m_pos]*10;
                                        ap->subm[i][j] += matrix_pointer[m_pos];
                                }else{
                                        //	subm[i][j] += blosum62mt[m_pos]*10;
                                        //	subm[j][i] += blosum62mt[m_pos]*10;
                                        ap->subm[i][j] += matrix_pointer[m_pos];
                                        ap->subm[j][i] += matrix_pointer[m_pos];
                                }
                                m_pos++;
                        }
                }
                /*for (i = 0; i < 23;i++){
                  for (j = 0; j < 23;j++){
                  fprintf(stderr,"%d ",subm[i][j]);
                  }
                  fprintf(stderr,"\n");
                  }
                  fprintf(stderr,"\n");*/
        }





        float balimt[]={
 2.420415,
 0.747121, 5.209610,
 -0.246410, -0.997330, 3.110732,
 0.154379, -1.083321, 1.158678, 2.681517,
 -0.446025, -0.026154, -1.142319, -1.016057, 3.510761,
 0.214828, -0.642689, -0.186559, -0.494668, -1.147637, 3.225504,
 -0.288471, -0.426255, 0.171148, 0.146036, 0.212356, -0.596093, 4.148174,
 -0.123453, 0.128064, -1.409191, -1.007479, 0.584028, -1.557203, -0.763072, 2.787728,
 0.182504, -0.970337, 0.304663, 0.850675, -0.957835, -0.325461, 0.284162, -0.794586, 2.647806,
 -0.164024, 0.040247, -1.186639, -0.825884, 1.013671, -1.391315, -0.354153, 1.348207, -0.545169, 2.523593,
 0.095638, 0.384396, -0.928356, -0.474076, 0.910479, -1.012954, -0.196555, 0.975663, -0.215075, 1.488754, 3.676938,
 -0.100049, -0.307696, 1.045118, 0.346370, -0.694593, 0.293164, 0.790324, -1.038712, 0.462057, -0.689173, -0.375917, 3.162906,
 -0.005026, -0.500290, -0.107106, 0.030602, -0.585839, -0.408680, -0.333466, -0.751461, -0.053477, -0.654948, -0.632932, -0.147628, 3.733436,
 0.168344, -0.583855, 0.455039, 1.066222, -0.553248, -0.449522, 0.682319, -0.627493, 1.021972, -0.232310, 0.256122, 0.506081, -0.116212, 3.027675,
 -0.155350, -0.577987, -0.201476, 0.286056, -0.811536, -0.717588, 0.513573, -0.717277, 1.320853, -0.479287, -0.237731, 0.219607, -0.342189, 0.822743, 3.266591,
 0.809518, 0.299711, 0.345164, 0.235684, -0.601382, 0.197465, 0.041369, -0.779745, 0.220501, -0.694139, -0.216848, 0.671367, 0.186857, 0.306560, 0.008706, 2.601806,
 0.325929, 0.428172, -0.053208, 0.053395, -0.374081, -0.460208, -0.043498, -0.040764, 0.179361, -0.231187, 0.142381, 0.316464, -0.162358, 0.212028, -0.011513, 1.148277, 2.881259,
 0.371841, 0.702162, -1.218901, -0.772785, 0.300936, -1.357957, -0.544881, 1.791316, -0.525849, 0.857932, 0.629459, -0.812818, -0.466289, -0.431884, -0.596182, -0.445733, 0.451791, 2.617557,
 -0.623582, -0.538328, -0.883882, -0.857629, 1.448970, -1.073929, 0.484818, -0.241197, -0.810376, 0.083866, 0.302183, -0.604871, -0.881386, -0.412425, -0.500269, -0.462709, -0.516104, -0.354963, 5.476864,
 -0.394793, -0.272838, -0.780817, -0.731373, 1.935874, -1.041866, 1.023095, -0.140141, -0.527044, 0.233800, 0.293401, -0.428925, -0.715600, -0.200490, -0.206814, -0.410650, -0.359953, -0.179508, 1.672116, 3.837386,
 0.403734, 0.257111, 1.168383, 1.140554, 0.286065, -0.513383, -0.693256, 0.616968, 0.654148, 0.450973, 1.131462, 0.783884, -1.080134, 1.898639, -0.669949, 0.691191, 0.331165, 0.327000, -1.045717, -0.407346, 6.987463,
};
ap->gpo = 3.598325;
ap->gpe =  0.365616;
ap->tgpe =  0.004882;

        m_pos = 0;
        for (i = 0;i < 21;i++){
                for (j = 0;j <= i;j++){
                        if (i == j){
                                //	subm[i][j] += blosum62mt[m_pos]*10;
                                ap->subm[i][j] = balimt[m_pos];
                        }else{
                                //	subm[i][j] += blosum62mt[m_pos]*10;
                                //	subm[j][i] += blosum62mt[m_pos]*10;
                                ap->subm[i][j] = balimt[m_pos];
                                ap->subm[j][i] = balimt[m_pos];
                        }
                        m_pos++;
                }
        }

        return OK;
}
